pipeline {
    agent { docker { image 'maven:3.3.3' } }
    stages {
        stage('build') {
            steps {
                sh 'mvn compile'
            }
        }
    }
    agent any
        stage('build docker image') {
            steps {
                sh 'docker build -t test/myapp .'
            }
        }
    }	
        stage('Deploy') {
            when {
              expression {
                currentBuild.result == null || currentBuild.result == 'SUCCESS' 
              }
            }
            steps {
                sh 'docker run -p 8081:8081 test/myapp'
            }	
		} 